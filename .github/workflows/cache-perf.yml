name: Cache performance testing

# Only run manually: the purpose of this test is to check how much (if at all)
# using the caches helps, and that's not something that needs doing often, and
# it is something that's time consuming.
on: workflow_dispatch

jobs:
  # This will populate the cache without using any pre-existing cache, so we
  # can see how long it takes to install without the cache.
  install-without-cache:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install a large set of Cygwin packages
        uses: ./
        with:
          packages: >
            biber doxygen evolution kde-dev-utils mkvtoolnix-debuginfo nghttp
            x11vnc dblatex doxygen-latex emacs-auctex emacs-gettext
            geany-plugins-geanylatex gettext gettext-debuginfo gettext-devel
            gettext-doc kf5-kpimtextedit-debuginfo kf5-ktexteditor-debuginfo
            kf5-ktextwidgets-debuginfo latex2rtf latex2rtf-debuginfo latexila
            latexila-debuginfo libboost_context1.60 libboost_context1.63
            libboost_context1.64 libboost_context1.66 libgettextpo-devel
            libgettextpo0 libptexenc-devel libptexenc1 libsynctex-devel
            libsynctex1 libsynctex2 libtexlua52-devel libtexlua52_5
            libtexlua53-devel libtexlua53_5 libtexluajit-devel libtexluajit2
            mate-text-editor mate-text-editor-devel mate-text-editor-plugins
            mingw64-i686-gettext mingw64-i686-gettext-debuginfo
            mingw64-x86_64-gettext mingw64-x86_64-gettext-debuginfo
            ocaml-gettext perl-gettext perl-gettext-debuginfo
            perl-Locale-gettext php-gettext preview-latex pstotext ruby-gettext
            ruby-gettext-doc ruby-text ruby-text-doc texi2html texinfo
            texinfo-debuginfo texinfo-tex texlive texlive-collection-basic
            texlive-collection-basic-doc texlive-collection-bibtexextra
            texlive-collection-bibtexextra-doc texlive-collection-binextra
            texlive-collection-binextra-doc texlive-collection-context
            texlive-collection-context-doc texlive-collection-fontsextra
            texlive-collection-fontsextra-doc
            texlive-collection-fontsrecommended
            texlive-collection-fontsrecommended-doc
            texlive-collection-fontutils texlive-collection-fontutils-doc
            texlive-collection-formatsextra texlive-collection-games
            texlive-collection-genericextra texlive-collection-genericextra-doc
            texlive-collection-genericrecommended
            texlive-collection-genericrecommended-doc
            texlive-collection-htmlxml texlive-collection-humanities
            texlive-collection-humanities-doc texlive-collection-langafrican
            texlive-collection-langarabic texlive-collection-langchinese
            texlive-collection-langcjk texlive-collection-langcyrillic
            texlive-collection-langczechslovak texlive-collection-langenglish
            texlive-collection-langeuropean texlive-collection-langfrench
            texlive-collection-langgerman texlive-collection-langgreek
            texlive-collection-langindic texlive-collection-langitalian
            texlive-collection-langjapanese texlive-collection-langkorean
            texlive-collection-langother texlive-collection-langpolish
            texlive-collection-langportuguese texlive-collection-langspanish
            texlive-collection-latex texlive-collection-latex-doc
            texlive-collection-latexextra texlive-collection-latexextra-doc
            texlive-collection-latexrecommended
            texlive-collection-latexrecommended-doc texlive-collection-luatex
            texlive-collection-luatex-doc texlive-collection-mathextra
            texlive-collection-mathextra-doc texlive-collection-mathscience
            texlive-collection-mathscience-doc texlive-collection-metapost
            texlive-collection-metapost-doc texlive-collection-music
            texlive-collection-music-doc texlive-collection-omega
            texlive-collection-pictures texlive-collection-pictures-doc
            texlive-collection-plainextra texlive-collection-plaingeneric
            texlive-collection-plaingeneric-doc texlive-collection-pstricks
            texlive-collection-pstricks-doc texlive-collection-publishers
            texlive-collection-publishers-doc texlive-collection-science
            texlive-collection-science-doc texlive-collection-xetex
            texlive-collection-xetex-doc texlive-debuginfo untex
          cache: saveonly

  # Because the cache restore process will prefer caches from the same job,
  # this will always restore the cache created by the install-without-cache
  # job, so we can check what difference using the cache makes.
  install-with-cache:
    runs-on: windows-latest
    needs: install-without-cache
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install a large set of Cygwin packages
        uses: ./
        with:
          packages: >
            biber doxygen evolution kde-dev-utils mkvtoolnix-debuginfo nghttp
            x11vnc dblatex doxygen-latex emacs-auctex emacs-gettext
            geany-plugins-geanylatex gettext gettext-debuginfo gettext-devel
            gettext-doc kf5-kpimtextedit-debuginfo kf5-ktexteditor-debuginfo
            kf5-ktextwidgets-debuginfo latex2rtf latex2rtf-debuginfo latexila
            latexila-debuginfo libboost_context1.60 libboost_context1.63
            libboost_context1.64 libboost_context1.66 libgettextpo-devel
            libgettextpo0 libptexenc-devel libptexenc1 libsynctex-devel
            libsynctex1 libsynctex2 libtexlua52-devel libtexlua52_5
            libtexlua53-devel libtexlua53_5 libtexluajit-devel libtexluajit2
            mate-text-editor mate-text-editor-devel mate-text-editor-plugins
            mingw64-i686-gettext mingw64-i686-gettext-debuginfo
            mingw64-x86_64-gettext mingw64-x86_64-gettext-debuginfo
            ocaml-gettext perl-gettext perl-gettext-debuginfo
            perl-Locale-gettext php-gettext preview-latex pstotext ruby-gettext
            ruby-gettext-doc ruby-text ruby-text-doc texi2html texinfo
            texinfo-debuginfo texinfo-tex texlive texlive-collection-basic
            texlive-collection-basic-doc texlive-collection-bibtexextra
            texlive-collection-bibtexextra-doc texlive-collection-binextra
            texlive-collection-binextra-doc texlive-collection-context
            texlive-collection-context-doc texlive-collection-fontsextra
            texlive-collection-fontsextra-doc
            texlive-collection-fontsrecommended
            texlive-collection-fontsrecommended-doc
            texlive-collection-fontutils texlive-collection-fontutils-doc
            texlive-collection-formatsextra texlive-collection-games
            texlive-collection-genericextra texlive-collection-genericextra-doc
            texlive-collection-genericrecommended
            texlive-collection-genericrecommended-doc
            texlive-collection-htmlxml texlive-collection-humanities
            texlive-collection-humanities-doc texlive-collection-langafrican
            texlive-collection-langarabic texlive-collection-langchinese
            texlive-collection-langcjk texlive-collection-langcyrillic
            texlive-collection-langczechslovak texlive-collection-langenglish
            texlive-collection-langeuropean texlive-collection-langfrench
            texlive-collection-langgerman texlive-collection-langgreek
            texlive-collection-langindic texlive-collection-langitalian
            texlive-collection-langjapanese texlive-collection-langkorean
            texlive-collection-langother texlive-collection-langpolish
            texlive-collection-langportuguese texlive-collection-langspanish
            texlive-collection-latex texlive-collection-latex-doc
            texlive-collection-latexextra texlive-collection-latexextra-doc
            texlive-collection-latexrecommended
            texlive-collection-latexrecommended-doc texlive-collection-luatex
            texlive-collection-luatex-doc texlive-collection-mathextra
            texlive-collection-mathextra-doc texlive-collection-mathscience
            texlive-collection-mathscience-doc texlive-collection-metapost
            texlive-collection-metapost-doc texlive-collection-music
            texlive-collection-music-doc texlive-collection-omega
            texlive-collection-pictures texlive-collection-pictures-doc
            texlive-collection-plainextra texlive-collection-plaingeneric
            texlive-collection-plaingeneric-doc texlive-collection-pstricks
            texlive-collection-pstricks-doc texlive-collection-publishers
            texlive-collection-publishers-doc texlive-collection-science
            texlive-collection-science-doc texlive-collection-xetex
            texlive-collection-xetex-doc texlive-debuginfo untex
          cache: restoreonly
